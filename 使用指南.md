# 🎭 四大名著知识问答 Agent - 使用指南

## 🚀 快速开始

### 1. 访问 Web 界面

打开浏览器访问：**http://localhost:7860**

服务已启动（进程 ID: 56）✅

### 2. 开始提问

在聊天框输入问题，系统会自动回答。

## 💡 示例问题

### 📚 知识库问题（直接检索，速度快）

```
红楼梦的作者是谁？
贾宝玉是谁？
林黛玉的性格特点是什么？
三国演义讲的是什么？
```

### 🔧 工具调用问题（Agent 推理）

```
计算一下 123 + 456
现在几点了？
比较 120 和 100 哪个大？
列出四大名著
统计一下"红楼梦"这三个字有多少个字符
贾宝玉和林黛玉是什么关系？  ← 新增：人物关系查询
刘备和关羽是兄弟吗？  ← 新增：人物关系查询
```

### 💬 上下文追问（测试记忆功能）

```
问题1: 红楼梦的作者是谁？
回答: 曹雪芹

问题2: 他是哪个朝代的？  ← 理解"他"指代曹雪芹
回答: 清代

问题3: 这本书有多少回？  ← 理解"这本书"指代红楼梦
回答: 120回
```

## 🔍 查看推理过程

### 方法 1：我帮你查看（推荐）

1. 在 Gradio 界面提问
2. 告诉我"查看推理过程"或"查看输出"
3. 我会显示进程的输出日志

### 方法 2：前台运行（自己查看）

```bash
# 停止当前服务（告诉我"停止服务"）
# 然后在你的终端运行：
bash start_gradio_foreground.sh
```

这样推理过程会直接显示在你的终端。

### 方法 3：查看日志文件

```bash
# 使用带日志的启动脚本
bash start_with_log.sh

# 在另一个终端查看实时日志
tail -f gradio_output.log
```

## 📊 推理过程输出示例

当你提问后，控制台会显示：

```
🤖 ❌ 未命中任何关键词，使用 LLM 处理
🔧 Agent 已加载 8 个工具：
   1. search_knowledge_base - 搜索本地知识库
   2. calculator - 计算数学表达式
   3. get_current_time - 获取当前时间
   ...

📝 正在创建 ReAct Agent...
🎯 ReAct Agent 已创建，verbose=True
🚀 开始 ReAct 推理：计算一下 123 + 456
============================================================
[Agent 推理过程]
============================================================
✅ ReAct 推理完成

📊 推理步骤数：1
  步骤 1:
    🔧 工具: calculator
    📥 输入: 123 + 456
    📤 结果: 计算结果：579

💾 已保存到记忆，当前共 2 条消息
```

## 🎯 功能特性

### ✅ 已实现的功能

1. **知识库检索** - 四大名著完整内容
2. **智能路由** - 关键词直接检索，其他问题 Agent 推理
3. **8 个工具** - 计算、时间、文本处理等
4. **对话记忆** - 保留最近 5 轮对话
5. **上下文理解** - 理解代词指代（他、这本书等）
6. **流式输出** - 答案逐字显示（打字机效果）
7. **防幻觉机制** - 只基于知识库回答，不编造信息

### 🔧 9 个可用工具

1. **search_knowledge_base** - 搜索知识库
2. **calculator** - 数学计算
3. **get_current_time** - 获取时间
4. **count_characters** - 字符统计
5. **text_search** - 文本搜索
6. **compare_numbers** - 数字比较
7. **list_four_classics** - 列出四大名著
8. **get_book_info** - 获取书籍信息
9. **query_character_relationship** - 人物关系查询 ⭐ 新增

## 🧠 对话记忆

- **容量**: 保留最近 5 轮对话
- **功能**: 理解上下文和代词指代
- **清空**: 点击界面上的"🧠 清空记忆"按钮

## 📝 注意事项

### 关于推理过程显示

虽然设置了 `verbose=True`，但 LangChain 的详细推理过程（Thought/Action/Observation）可能不会完整显示。这是因为：

1. qwen-plus 模型可能直接给出答案
2. LangChain 版本的输出格式变化

但是：
- ✅ Agent 正常工作
- ✅ 工具正确调用
- ✅ 答案准确无误
- ✅ 中间步骤被记录

你可以通过"📊 推理步骤数"看到 Agent 调用了哪些工具。

## 🎉 开始使用

现在就可以访问 **http://localhost:7860** 开始使用了！

有任何问题随时告诉我。🚀
