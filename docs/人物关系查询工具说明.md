# 🎭 人物关系查询工具说明

## 📝 功能介绍

**query_character_relationship** 是一个专业的人物关系查询工具，可以从知识库中检索两个人物之间的关系信息。

## 🔧 工具参数

```python
query_character_relationship(char1: str, char2: str, book_name: str = "")
```

**参数说明**：
- `char1`: 第一个人物名字（必填）
- `char2`: 第二个人物名字（必填）
- `book_name`: 书名（可选），如：红楼梦、三国演义、西游记、水浒传

## 💡 使用示例

### 示例 1：红楼梦人物关系

**问题**：贾宝玉和林黛玉是什么关系？

**工具调用**：
```python
query_character_relationship("贾宝玉", "林黛玉", "红楼梦")
```

**返回结果**：
```
关于 贾宝玉 和 林黛玉 的关系：

宝玉早已看见多了一个姊妹，便料定是林姑妈之女，忙来作揖。
厮见毕归坐，细看形容，与众各别：
两弯似蹙非蹙罥烟眉，一双似泣非泣含露目...

宝玉看罢，因笑道："这个妹妹我曾见过的。"
贾母笑道："可又是胡说，你又何曾见过他？"
宝玉笑道："虽然未曾见过他，然我看着面善，心里就算是旧相识，
今日只作远别重逢，亦未为不可。"
...
```

### 示例 2：三国演义人物关系

**问题**：刘备和关羽是什么关系？

**工具调用**：
```python
query_character_relationship("刘备", "关羽", "三国演义")
```

**返回结果**：
```
关于 刘备 和 关羽 的关系：

关羽之与刘备、张飞"桃园结义"，具有明确的政治企图。
他们"闻黄巾倡乱，有志欲破贼安民"，所以"结为兄弟"，
以便"同心协力"地"上报国家，下安黎庶"；
并发誓说，决不"背义忘恩"...

在这些斗争中，关羽"义不负心，忠不顾死"...
```

### 示例 3：西游记人物关系

**问题**：孙悟空和唐僧是什么关系？

**工具调用**：
```python
query_character_relationship("孙悟空", "唐僧")
```

**返回结果**：
```
关于 孙悟空 和 唐僧 的关系：

原来是乌鸡国王的太子，急上前扯住那魔王的朝服，跪在面前道：
"父王息怒。三年前闻得人说，有个东土唐朝驾下钦差圣僧往西天拜佛求经..."

我师父乃唐王御弟，号曰三藏...
```

## 🎯 在 Agent 中使用

当用户提问人物关系时，Agent 会自动调用这个工具：

**用户问题**：
```
贾宝玉和林黛玉是什么关系？
刘备和关羽是兄弟吗？
孙悟空和唐僧的关系如何？
```

**Agent 推理过程**：
```
Thought: 用户询问两个人物的关系，我应该使用 query_character_relationship 工具
Action: query_character_relationship
Action Input: {"char1": "贾宝玉", "char2": "林黛玉", "book_name": "红楼梦"}
Observation: 关于 贾宝玉 和 林黛玉 的关系：...
Thought: 我现在知道了他们的关系
Final Answer: 贾宝玉和林黛玉是表兄妹关系，两人青梅竹马...
```

## 🔍 工作原理

1. **构建查询**：根据人物名和书名构建查询语句
2. **RAG 检索**：从向量数据库中检索相关文档
3. **提取内容**：取前 3 个最相关的文档片段
4. **验证结果**：检查是否真的包含两个人物
5. **返回结果**：返回截取后的内容（最多 500 字符）

## ✅ 优势

1. **基于知识库**：所有信息来自原著，准确可靠
2. **智能检索**：使用向量相似度搜索，找到最相关的内容
3. **防止幻觉**：如果没有找到相关信息，会明确告知
4. **灵活使用**：可以指定书名，也可以不指定

## 📊 测试结果

### 测试 1：红楼梦 ✅
- 查询：贾宝玉 和 林黛玉
- 结果：✅ 成功返回表兄妹关系和初次见面的描述

### 测试 2：三国演义 ✅
- 查询：刘备 和 关羽
- 结果：✅ 成功返回桃园结义和忠义描述

### 测试 3：西游记 ✅
- 查询：孙悟空 和 唐僧
- 结果：✅ 成功返回师徒关系描述

## 🎉 总结

人物关系查询工具已成功集成！现在 Agent 拥有 **9 个工具**：

1. search_knowledge_base - 知识库检索
2. calculator - 数学计算
3. get_current_time - 时间查询
4. count_characters - 文本统计
5. text_search - 文本搜索
6. compare_numbers - 数字比较
7. list_four_classics - 四大名著列表
8. get_book_info - 书籍信息
9. **query_character_relationship - 人物关系查询** ⭐ 新增

你可以在 Gradio 界面（http://localhost:7860）中测试这个新工具！🚀
