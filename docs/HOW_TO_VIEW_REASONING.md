# 如何查看 ReAct 推理过程

## 📺 推理过程显示位置

由于 ReAct Agent 的 `verbose=True` 设置，推理过程会在**控制台（终端）**中实时显示。

## 🔍 查看方法

### 方法 1：查看启动终端

如果你是通过终端启动的服务：

```bash
bash start_gradio.sh
```

推理过程会直接显示在这个终端窗口中。

### 方法 2：查看进程输出（当前方法）

由于服务在后台运行，推理过程会输出到进程日志中。

## 📝 推理过程示例

当你在 Gradio 界面中提问时，终端会显示类似这样的推理过程：

### 示例 1：简单问题（直接检索）

**问题**："红楼梦的作者是谁？"

**终端输出**：
```
🎯 ✅ 命中关键词: 是谁，直接检索向量库
💾 已保存到记忆，当前共 2 条消息
```

### 示例 2：需要 Agent 推理的问题

**问题**："计算一下 123 + 456"

**终端输出**：
```
🤖 ❌ 未命中任何关键词，使用 LLM 处理
🔧 Agent 已加载 8 个工具：
   1. search_knowledge_base - 搜索本地知识库中的信息...
   2. calculator - 计算数学表达式...
   3. get_current_time - 获取当前时间和日期...
   ...

> Entering new AgentExecutor chain...

Thought: 这是一个数学计算问题，我需要使用计算器工具
Action: calculator
Action Input: 123 + 456
Observation: 计算结果：579

Thought: 我现在知道最终答案了
Final Answer: 123 + 456 = 579

> Finished chain.

💾 已保存到记忆，当前共 4 条消息
```

### 示例 3：多步推理

**问题**："比较 120 和 100 哪个大？"

**终端输出**：
```
🤖 ❌ 未命中任何关键词，使用 LLM 处理

> Entering new AgentExecutor chain...

Thought: 这是一个数字比较问题，我需要使用 compare_numbers 工具
Action: compare_numbers
Action Input: {"num1": 120, "num2": 100}
Observation: 120 大于 100，差值为 20

Thought: 我得到了比较结果
Final Answer: 120 大于 100，差值为 20

> Finished chain.

💾 已保存到记忆，当前共 6 条消息
```

## 🎯 推理过程解读

### 1. Thought（思考）
Agent 分析问题，决定下一步做什么

### 2. Action（行动）
选择要使用的工具

### 3. Action Input（输入）
传递给工具的参数

### 4. Observation（观察）
工具返回的结果

### 5. Final Answer（最终答案）
基于观察结果给出的最终回答

## 💡 测试建议

### 测试 1：直接检索（不会显示推理）
- "红楼梦的作者是谁？"
- "贾宝玉是谁？"

这些问题会命中关键词，直接检索，不会触发 ReAct 推理。

### 测试 2：工具调用（会显示推理）
- "计算一下 123 + 456"
- "现在几点了？"
- "比较 120 和 100"
- "列出四大名著"

这些问题会触发 Agent 推理，在终端显示完整的推理过程。

### 测试 3：上下文追问
```
问题1: "红楼梦的作者是谁？"
问题2: "他是哪个朝代的？"  ← 会显示推理过程
问题3: "这本书有多少回？"  ← 会显示推理过程
```

## 🔧 调试技巧

### 1. 实时查看日志

如果想实时查看推理过程，可以在另一个终端运行：

```bash
# 查看最新的 50 行输出
tail -f -n 50 /path/to/log
```

### 2. 增加详细度

在 `agent.py` 中，`AgentExecutor` 的 `verbose=True` 已经启用，这会显示：
- 每一步的思考
- 工具调用
- 工具返回结果
- 最终答案

### 3. 自定义日志

如果想将推理过程保存到文件，可以修改启动脚本：

```bash
venv/bin/python app_gradio.py 2>&1 | tee gradio.log
```

这样推理过程会同时显示在终端和保存到 `gradio.log` 文件。

## 📊 流式输出说明

### 当前实现

1. **思考状态**：先显示 "🤔 正在思考..."
2. **流式输出**：答案逐字显示（每 5 个字符或遇到标点更新一次）
3. **来源标注**：显示知识库来源和引用数量

### 效果

- ✅ 用户看到逐字显示的答案
- ✅ 有打字机效果
- ✅ 推理过程在终端显示

## 🎉 总结

- **推理过程**：在启动服务的终端中显示
- **流式输出**：在 Gradio 界面中逐字显示
- **最佳体验**：同时查看终端（推理）和浏览器（答案）

现在可以在浏览器中提问，同时观察终端的推理过程了！🚀
