# 📊 人物关系查询工具 - 日志说明

## 🎯 日志功能

人物关系查询工具现在包含详细的日志输出，让你能够清楚地看到整个查询过程。

## 📝 日志内容

### 1. 查询参数
```
📝 查询参数：
   - 人物1: 贾宝玉
   - 人物2: 林黛玉
   - 书名: 红楼梦
```

显示用户输入的查询参数。

### 2. RAG 初始化
```
🔧 初始化 RAG 检索器...
✅ RAG 检索器初始化完成
```

显示 RAG 检索器的初始化过程。

### 3. 查询语句构建
```
🔎 构建查询语句: "红楼梦 贾宝玉 林黛玉 关系"
```

显示根据参数构建的实际查询语句。

### 4. 知识库检索
```
📚 开始检索知识库...
✅ 检索完成，找到 3 个相关文档
```

显示检索过程和找到的文档数量。

### 5. 文档详情
```
📄 检索到的文档详情：
   1. 来源: data/红楼梦.epub, 页码: 未知
      预览: 贾母因笑道："外客未见，就脱了衣裳...
   2. 来源: data/红楼梦.epub, 页码: 未知
      预览: 宝玉看罢，因笑道："这个妹妹我曾见过的...
   3. 来源: data/红楼梦.epub, 页码: 未知
      预览: 即如此刻，宝玉的心内想的是...
```

显示检索到的每个文档的来源、页码和内容预览。

### 6. 内容提取
```
📝 提取前 3 个最相关的文档内容...
✅ 提取完成，总字符数: 2276
```

显示提取的文档数量和总字符数。

### 7. 人物验证
```
🔍 验证内容是否包含两个人物...
   - 贾宝玉: ❌ 未找到
   - 林黛玉: ✅ 找到
```

验证检索到的内容是否真的包含查询的两个人物。

### 8. 内容截取
```
✂️ 截取内容（最多 500 字符）...
✅ 内容已截取（原长度: 2276 -> 截取后: 500）
```

显示内容截取的过程和长度变化。

### 9. 完成状态
```
🎉 人物关系查询完成！
```

显示查询成功完成。

## 📊 完整日志示例

### 示例 1：红楼梦人物关系

```
================================================================================
🔍 人物关系查询工具
================================================================================
📝 查询参数：
   - 人物1: 贾宝玉
   - 人物2: 林黛玉
   - 书名: 红楼梦

🔧 初始化 RAG 检索器...
✅ RAG 检索器初始化完成

🔎 构建查询语句: "红楼梦 贾宝玉 林黛玉 关系"

📚 开始检索知识库...
✅ 检索完成，找到 3 个相关文档

📄 检索到的文档详情：
   1. 来源: data/红楼梦.epub, 页码: 未知
      预览: 贾母因笑道："外客未见，就脱了衣裳，还不去见你妹妹！"...
   2. 来源: data/红楼梦.epub, 页码: 未知
      预览: 宝玉看罢，因笑道："这个妹妹我曾见过的。"...
   3. 来源: data/红楼梦.epub, 页码: 未知
      预览: 即如此刻，宝玉的心内想的是："别人不知我的心...

📝 提取前 3 个最相关的文档内容...
✅ 提取完成，总字符数: 2276

🔍 验证内容是否包含两个人物...
   - 贾宝玉: ❌ 未找到
   - 林黛玉: ✅ 找到

✂️ 截取内容（最多 500 字符）...
✅ 内容已截取（原长度: 2276 -> 截取后: 500）

🎉 人物关系查询完成！
================================================================================
```

### 示例 2：三国演义人物关系

```
================================================================================
🔍 人物关系查询工具
================================================================================
📝 查询参数：
   - 人物1: 刘备
   - 人物2: 关羽
   - 书名: 三国演义

🔧 初始化 RAG 检索器...
✅ RAG 检索器初始化完成

🔎 构建查询语句: "三国演义 刘备 关羽 关系"

📚 开始检索知识库...
✅ 检索完成，找到 3 个相关文档

📄 检索到的文档详情：
   1. 来源: data/三国演义.epub, 页码: 未知
      预览: 关羽也是《三国演义》着力描写的人物...
   2. 来源: data/三国演义.epub, 页码: 未知
      预览: 关羽也是《三国演义》着力描写的人物...
   3. 来源: data/三国演义.epub, 页码: 未知
      预览: 且说关公正寻思间，忽报有故人相访...

📝 提取前 3 个最相关的文档内容...
✅ 提取完成，总字符数: 2718

🔍 验证内容是否包含两个人物...
   - 刘备: ✅ 找到
   - 关羽: ✅ 找到

✂️ 截取内容（最多 500 字符）...
✅ 内容已截取（原长度: 2718 -> 截取后: 500）

🎉 人物关系查询完成！
================================================================================
```

## 🔍 如何查看日志

### 方法 1：通过 Gradio 进程输出

当你在 Gradio 界面（http://localhost:7860）提问时，日志会输出到进程控制台。

告诉 AI 助手"查看推理过程"或"查看进程输出"，就能看到日志。

### 方法 2：前台运行

```bash
# 停止当前服务
# 然后运行
bash start_gradio_foreground.sh
```

日志会直接显示在你的终端。

### 方法 3：查看日志文件

```bash
# 使用带日志的启动脚本
bash start_with_log.sh

# 在另一个终端查看实时日志
tail -f gradio_output.log
```

### 方法 4：直接测试工具

```bash
# 运行测试脚本
venv/bin/python test_tool_direct.py
```

## 📊 日志的作用

### 1. 调试
- 查看查询语句是否正确
- 检查检索到的文档数量
- 验证人物是否被找到

### 2. 优化
- 分析哪些查询效果好
- 了解文档来源分布
- 评估内容截取是否合理

### 3. 学习
- 理解 RAG 检索过程
- 了解向量相似度搜索
- 学习知识库的组织方式

### 4. 透明度
- 让用户知道系统在做什么
- 增加信任度
- 便于问题排查

## 🎯 日志图标说明

- 🔍 - 查询/搜索
- 📝 - 参数/内容
- 🔧 - 初始化/配置
- ✅ - 成功/完成
- ❌ - 失败/未找到
- 📚 - 知识库/文档
- 📄 - 文档详情
- ✂️ - 截取/处理
- 🎉 - 完成/成功

## 💡 使用建议

1. **开发阶段**：使用前台运行或日志文件，方便调试
2. **生产环境**：可以关闭详细日志，只保留关键信息
3. **问题排查**：遇到问题时，查看日志可以快速定位原因
4. **性能优化**：通过日志分析查询效率，优化检索策略

## 🎉 总结

人物关系查询工具现在包含完整的日志输出，让整个查询过程透明可见！

你可以清楚地看到：
- 查询参数
- 检索过程
- 文档来源
- 验证结果
- 内容处理

这对于调试、优化和学习都非常有帮助！🚀
