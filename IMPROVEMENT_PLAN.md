# 四大名著知识问答系统 - 改进计划

## 📋 改进优先级分级

- 🔥 **P0 - 高优先级**：显著提升用户体验，实现简单
- ⭐ **P1 - 中优先级**：有价值的功能增强
- 💡 **P2 - 低优先级**：锦上添花的功能

---

## 🔥 P0 - 高优先级改进（建议优先实现）

### 1. 清空对话功能
**状态**: ✅ 已完成  
**实际时间**: 10分钟  
**价值**: 用户可以快速开始新对话，避免页面混乱

**已实现内容**:
- ✅ 添加"清空对话"按钮（右上角）
- ✅ 点击后清空所有聊天气泡
- ✅ 添加确认提示避免误操作
- ✅ 添加淡出动画效果

**技术实现**:
- 右上角添加半透明玻璃效果按钮
- JavaScript 清空 `chatMessages` DOM
- 0.3秒淡出动画
- 确认对话框防止误操作

---

### 2. 书籍筛选功能
**状态**: ⏳ 待实现  
**预计时间**: 30分钟  
**价值**: 提升检索精准度，用户可以指定在某本书中查找

**实现内容**:
- 在输入框上方添加书籍选择下拉框
- 选项：全部 / 红楼梦 / 三国演义 / 西游记 / 水浒传
- 选择后只在该书中检索答案
- 显示当前选择的书籍标签

**技术要点**:
- 前端：添加 `<select>` 下拉框
- 后端：`/chat` 接口已支持 `book` 参数
- 使用 `rag.search_by_book()` 方法

---

### 3. 复制答案按钮
**状态**: ⏳ 待实现  
**预计时间**: 15分钟  
**价值**: 方便用户复制答案内容

**实现内容**:
- 每个答案气泡右上角添加"复制"按钮
- 点击后复制纯文本内容
- 显示"已复制"提示

**技术要点**:
- 使用 `navigator.clipboard.writeText()`
- 提取纯文本（去除 HTML 标签）
- 添加复制成功提示

---

### 4. 显示答案耗时
**状态**: ⏳ 待实现  
**预计时间**: 15分钟  
**价值**: 让用户了解系统响应速度

**实现内容**:
- 记录问题发送时间和答案完成时间
- 在答案底部显示耗时（如"耗时 2.3秒"）
- 使用灰色小字显示

**技术要点**:
- 前端记录 `startTime` 和 `endTime`
- 计算时间差并格式化显示
- 添加到元数据区域

---

### 5. 常见问题快捷按钮
**状态**: ⏳ 待实现  
**预计时间**: 20分钟  
**价值**: 降低使用门槛，新用户可以快速体验

**实现内容**:
- 在聊天区域为空时显示常见问题卡片
- 预设问题：
  - "贾宝玉是谁？"
  - "诸葛亮的主要事迹有哪些？"
  - "孙悟空的师傅是谁？"
  - "水浒传中的梁山好汉有哪些？"
- 点击后自动填充并发送

**技术要点**:
- 检测 `chatMessages` 是否为空
- 动态显示/隐藏快捷问题区域
- 点击后调用 `submitQuery()`

---

## ⭐ P1 - 中优先级改进

### 6. 输入体验优化
**状态**: ⏳ 待实现  
**预计时间**: 25分钟  
**价值**: 提升输入便利性

**实现内容**:
- 支持 Shift+Enter 换行，Enter 发送
- 输入框自动扩展（多行输入）
- 添加字数统计（可选）
- 输入时禁用发送按钮（防止重复提交）

**技术要点**:
- 监听 `keydown` 事件区分 Enter 和 Shift+Enter
- 使用 `<textarea>` 替代 `<input>`
- CSS 设置 `resize: vertical`

---

### 7. 重新生成答案
**状态**: ⏳ 待实现  
**预计时间**: 20分钟  
**价值**: 用户对答案不满意时可以重新生成

**实现内容**:
- 每个答案气泡添加"重新生成"按钮
- 点击后重新请求相同问题
- 替换原答案或添加新答案（可选）

**技术要点**:
- 保存每个问题的原始文本
- 重新调用 `/chat` 接口
- 更新对应的答案气泡

---

### 8. 引用来源展开查看
**状态**: ⏳ 待实现  
**预计时间**: 30分钟  
**价值**: 用户可以查看完整的引用文本

**实现内容**:
- 引用来源默认折叠
- 点击"展开"查看完整文本片段
- 高亮显示匹配的关键词
- 支持折叠/展开切换

**技术要点**:
- 后端返回完整的 `page_content`
- 前端使用折叠/展开动画
- 使用正则表达式高亮关键词

---

### 9. 搜索历史记录
**状态**: ⏳ 待实现  
**预计时间**: 35分钟  
**价值**: 方便用户查看和重新提问历史问题

**实现内容**:
- 使用 localStorage 保存最近 20 条搜索
- 添加"历史记录"按钮
- 点击历史问题快速重新提问
- 支持清空历史记录

**技术要点**:
- `localStorage.setItem()` 保存历史
- JSON 序列化/反序列化
- 添加历史记录侧边栏或下拉框

---

### 10. 加载动画优化
**状态**: ⏳ 待实现  
**预计时间**: 20分钟  
**价值**: 提升视觉体验

**实现内容**:
- 流式输出时显示打字机光标（闪烁的 `|`）
- "思考中"显示更生动的动画（如跳动的点）
- 答案完成后移除光标

**技术要点**:
- CSS 动画实现光标闪烁
- 流式输出时添加光标元素
- 完成后移除光标

---

### 11. 错误处理优化
**状态**: ⏳ 待实现  
**预计时间**: 25分钟  
**价值**: 提升系统稳定性

**实现内容**:
- 网络超时自动重试（最多 3 次）
- 更友好的错误提示信息
- 区分不同错误类型（网络错误、服务器错误、超时）
- 添加"重试"按钮

**技术要点**:
- 封装 fetch 请求，添加重试逻辑
- 捕获不同类型的异常
- 显示具体的错误原因

---

### 12. 响应式设计优化
**状态**: ⏳ 待实现  
**预计时间**: 40分钟  
**价值**: 支持移动端访问

**实现内容**:
- 适配手机屏幕（宽度 < 768px）
- 调整聊天气泡宽度和字体大小
- 优化按钮大小和间距
- 添加移动端手势支持（可选）

**技术要点**:
- 使用 CSS Media Queries
- 调整 `.chat-box` 高度和布局
- 测试不同设备尺寸

---

## 💡 P2 - 低优先级改进（锦上添花）

### 13. 主题切换（深色/浅色模式）
**状态**: ⏳ 待实现  
**预计时间**: 45分钟  
**价值**: 个性化体验

**实现内容**:
- 添加主题切换按钮（太阳/月亮图标）
- 支持深色模式和浅色模式
- 使用 localStorage 保存用户偏好
- 自动检测系统主题（可选）

**技术要点**:
- CSS 变量定义颜色主题
- JavaScript 切换 `data-theme` 属性
- `prefers-color-scheme` 媒体查询

---

### 14. 答案缓存
**状态**: ⏳ 待实现  
**预计时间**: 30分钟  
**价值**: 提升响应速度，减少 API 调用

**实现内容**:
- 缓存最近 50 个问答对
- 相同问题直接返回缓存答案
- 显示"来自缓存"标记
- 支持强制刷新

**技术要点**:
- 后端使用 LRU 缓存（`functools.lru_cache`）
- 或使用 Redis 缓存
- 前端显示缓存标记

---

### 15. 相关问题推荐
**状态**: ⏳ 待实现  
**预计时间**: 60分钟  
**价值**: 引导用户深入探索

**实现内容**:
- 根据当前问题推荐 3-5 个相关问题
- 显示在答案底部
- 点击后自动提问
- 使用关键词匹配或 LLM 生成

**技术要点**:
- 提取问题中的关键词
- 从预设问题库中匹配
- 或使用 LLM 生成相关问题

---

### 16. 多轮对话上下文
**状态**: ⏳ 待实现  
**预计时间**: 90分钟  
**价值**: 支持追问，更自然的对话

**实现内容**:
- 记住最近 5 轮对话
- 支持代词指代（"他"、"她"）
- 支持追问（"他的妻子是谁？"）
- 显示上下文引用

**技术要点**:
- 前端维护对话历史数组
- 后端接收对话历史
- LLM 处理上下文理解

---

### 17. 导出对话功能
**状态**: ⏳ 待实现  
**预计时间**: 30分钟  
**价值**: 保存对话记录

**实现内容**:
- 导出为 Markdown 格式
- 导出为 PDF（可选）
- 导出为纯文本
- 包含时间戳和元数据

**技术要点**:
- 遍历所有对话生成 Markdown
- 使用 `Blob` 和 `URL.createObjectURL` 下载
- 可选：使用 jsPDF 生成 PDF

---

### 18. 语音输入/输出
**状态**: ⏳ 待实现  
**预计时间**: 120分钟  
**价值**: 无障碍访问，提升便利性

**实现内容**:
- 支持语音输入（麦克风按钮）
- 支持朗读答案（播放按钮）
- 显示语音识别状态
- 支持暂停/继续

**技术要点**:
- 使用 Web Speech API
- `SpeechRecognition` 语音识别
- `SpeechSynthesis` 语音合成

---

### 19. 知识图谱可视化
**状态**: ⏳ 待实现  
**预计时间**: 180分钟  
**价值**: 直观展示人物关系

**实现内容**:
- 显示人物关系图（如贾宝玉的关系网）
- 使用图形化展示
- 支持点击节点查看详情
- 支持缩放和拖拽

**技术要点**:
- 使用 D3.js 或 ECharts
- 后端提供关系数据 API
- 前端渲染图谱

---

### 20. 统计分析面板
**状态**: ⏳ 待实现  
**预计时间**: 90分钟  
**价值**: 了解系统使用情况

**实现内容**:
- 显示最热门问题 TOP 10
- 显示知识库覆盖率
- 显示平均响应时间
- 显示用户满意度

**技术要点**:
- 后端记录查询日志
- 统计分析数据
- 前端图表展示（ECharts）

---

## 📊 实施建议

### 第一阶段（1-2小时）- 快速提升体验
- ✅ 清空对话功能
- ✅ 复制答案按钮
- ✅ 显示答案耗时
- ✅ 常见问题快捷按钮

### 第二阶段（2-3小时）- 核心功能增强
- ✅ 书籍筛选功能
- ✅ 输入体验优化
- ✅ 重新生成答案
- ✅ 加载动画优化

### 第三阶段（3-4小时）- 深度优化
- ✅ 引用来源展开查看
- ✅ 搜索历史记录
- ✅ 错误处理优化
- ✅ 响应式设计优化

### 第四阶段（按需实现）- 高级功能
- 主题切换
- 答案缓存
- 相关问题推荐
- 多轮对话上下文
- 其他高级功能

---

## 🎯 下一步行动

请告诉我你想从哪个功能开始实现，我会按照计划逐个帮你完成！

建议从 **P0 高优先级** 开始，这些功能实现快、效果好，能快速提升用户体验。

**推荐顺序**：
1. 清空对话功能（10分钟）
2. 复制答案按钮（15分钟）
3. 显示答案耗时（15分钟）
4. 常见问题快捷按钮（20分钟）
5. 书籍筛选功能（30分钟）

---

**文档版本**: v1.0  
**创建时间**: 2026-02-02  
**最后更新**: 2026-02-02
