# 🎉 Gradio 服务已启动成功！

## 访问信息

### Gradio Web 界面
```
http://localhost:7860
```

在浏览器中打开上面的地址即可使用！

## 功能说明

### 1. 💬 对话功能
- **四大名著知识问答** - 基于本地知识库
- **对话记忆** - 保留最近 5 轮对话
- **上下文理解** - 理解代词指代（如"他"、"这本书"）
- **智能路由** - 关键词直接检索，提高响应速度
- **11 个工具** - 计算、时间、文本处理、人物关系查询等

### 2. 📸 证件照生成
- **上传照片** - 支持 JPG、PNG 等格式
- **自动处理** - 人脸检测、智能裁剪、背景替换
- **多种规格** - 1寸、2寸、护照、身份证等 10+ 种尺寸
- **多种背景** - 白色、蓝色、红色、浅蓝
- **高清输出** - 300 DPI，专业品质
- **图片显示** - 生成的证件照直接显示在对话中

### 3. 🧠 记忆管理
- 自动保存对话历史
- 可以清空记忆开始新话题
- 支持上下文追问

## 使用方法

### 知识问答
直接在对话框中输入问题：
```
红楼梦的作者是谁？
贾宝玉和林黛玉是什么关系？
计算 123 + 456
现在几点了？
```

### 证件照生成

**步骤 1**: 在右侧"证件照生成"区域上传照片

**步骤 2**: 在对话框中输入要求：
```
生成1寸白底证件照
生成2寸蓝底证件照
生成护照照片
```

**步骤 3**: 查看结果
- ✅ 证件照会直接显示在对话中
- ✅ 可以下载生成的图片
- ✅ 可以继续生成其他规格

## 技术信息

- **框架**: Gradio
- **端口**: 7860
- **主机**: 0.0.0.0（允许外部访问）
- **LLM**: 阿里云 qwen-plus
- **Embedding**: 阿里云 text-embedding-v3
- **图片处理**: HivisionIDPhotos

## 服务管理

### 查看服务状态
服务正在后台运行（进程 ID: 192）

### 查看日志
```bash
# 日志会实时显示在终端中
# Agent 的推理过程也会显示
```

### 停止服务
按 `Ctrl+C` 或关闭终端

### 重启服务
```bash
python3 app_gradio.py
```

或使用启动脚本：
```bash
./start_gradio.sh
```

## 示例对话

### 示例 1: 知识问答
```
用户: 红楼梦的作者是谁？
AI: 曹雪芹

用户: 他是哪个朝代的？  ← 理解"他"指代曹雪芹
AI: 清代

用户: 这本书有多少回？  ← 理解"这本书"指代红楼梦
AI: 120回
```

### 示例 2: 证件照生成
```
用户: [上传照片] 生成1寸白底证件照
AI: ✅ 已成功生成 1寸 白色底证件照！
    📏 尺寸：295 x 413 px
    [显示证件照图片]

用户: 再生成一个2寸蓝底的
AI: ✅ 已成功生成 2寸 蓝色底证件照！
    📏 尺寸：413 x 579 px
    [显示证件照图片]
```

### 示例 3: 综合使用
```
用户: 计算 123 + 456
AI: 计算结果：579

用户: 现在几点了？
AI: 当前时间：2026-02-03 16:50:23

用户: 列出四大名著
AI: 中国四大名著包括：
    1. 红楼梦 - 曹雪芹
    2. 三国演义 - 罗贯中
    3. 西游记 - 吴承恩
    4. 水浒传 - 施耐庵
```

## 支持的证件照规格

| 规格 | 尺寸 (px) | 用途 |
|------|-----------|------|
| 1寸 | 295 x 413 | 通用证件照 |
| 小1寸 | 260 x 378 | 小型证件 |
| 2寸 | 413 x 579 | 大型证件照 |
| 小2寸 | 378 x 567 | 中型证件 |
| 大1寸 | 390 x 567 | 特殊证件 |
| 护照 | 354 x 472 | 护照照片 |
| 身份证 | 358 x 441 | 身份证照片 |
| 驾驶证 | 260 x 378 | 驾驶证照片 |
| 社保卡 | 358 x 441 | 社保卡照片 |
| 教师资格证 | 295 x 413 | 教师资格证 |

## 支持的背景颜色

- 白色 / 白底
- 蓝色 / 蓝底
- 红色 / 红底
- 浅蓝 / 浅蓝色

## 故障排除

### 问题 1: 无法访问
**检查**: 服务是否运行
```bash
lsof -i :7860
```

### 问题 2: 图片不显示
**原因**: Gradio 的 `allowed_paths` 配置
**解决**: 已在代码中配置 `allowed_paths=["app/static/photos", "app/static/uploads"]`

### 问题 3: 证件照生成失败
**检查**:
1. 图片是否成功上传
2. HivisionIDPhotos 是否正确安装
3. 查看终端错误信息

### 问题 4: 端口被占用
**解决**:
```bash
# 查看占用端口的进程
lsof -i :7860

# 停止进程
kill -9 <PID>
```

## 关于旧的 index.html

之前的 `app/static/index.html` 和 `app/main.py` (FastAPI) 是早期版本，现在已经不使用了。

**当前架构**:
- ✅ **Gradio** (`app_gradio.py`) - 主要界面
- ❌ ~~FastAPI + index.html~~ - 已废弃

如果需要，可以删除：
- `app/static/index.html`
- `app/main.py` 中的 Web 相关代码

## 下一步

1. 在浏览器中打开 **http://localhost:7860**
2. 尝试提问或生成证件照
3. 享受使用！

---

**提示**: 
- 如果需要从其他设备访问，使用你的 IP 地址：`http://<你的IP>:7860`
- 如果需要公开分享，在代码中设置 `share=True`
